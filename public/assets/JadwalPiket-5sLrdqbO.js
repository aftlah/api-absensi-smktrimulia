import{j as a}from"./query-vendor-CL32O2jR.js";import{r as l}from"./router-vendor-CjMceo_z.js";import{L as X,w as Z,x as ee,r as b}from"./admin-pages-BGiHTXEV.js";import{S as c}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-BmMXCZbk.js";const re=()=>{const[f,k]=l.useState([]),[o,U]=l.useState([]),[C,d]=l.useState(!1),[T,m]=l.useState(null),[B,j]=l.useState(!1),[x,y]=l.useState(null),[M,w]=l.useState(""),[S,v]=l.useState(""),[G,J]=l.useState(""),[n,g]=l.useState({senin:"",selasa:"",rabu:"",kamis:"",jumat:""}),L=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];function N(e){const[t,s,i]=(e||"").split("-").map(Number);return new Date(t,(s||1)-1,i||1)}function A(e){const t=N(e);return L[t.getDay()]||"-"}function E(e){const[t,s,i]=(e||"").split("-");return!t||!s||!i?e||"-":`${i}-${s}-${t}`}async function $(){d(!0),m(null);try{const[e,t]=await Promise.all([b.getJadwalPiket(),b.getGuruPiket()]),s=e?.data?.responseData?.jadwal??[];k(Array.isArray(s)?s:[]),U(t?.data?.responseData?.gurket??[])}catch{m("Gagal memuat data jadwal piket")}finally{d(!1)}}l.useEffect(()=>{const t=new Date().toISOString().slice(0,10);w(t),$()},[]);function R(){y(null);const t=new Date().toISOString().slice(0,10);w(t),J(t),g({senin:"",selasa:"",rabu:"",kamis:"",jumat:""}),v(o[0]?.gurket_id?String(o[0].gurket_id):""),j(!0)}function O(e){y(e),w(e?.tanggal||""),v(String(e?.gurket_id||e?.guru_piket?.gurket_id||"")),j(!0)}function _(){j(!1),y(null)}async function V(e){e.preventDefault();try{if(d(!0),x){const t=new Date;t.setHours(0,0,0,0);const s=N(M);if(s.setHours(0,0,0,0),s<t){m("Tanggal tidak boleh sebelum hari ini"),d(!1);return}if(!S){m("Guru piket wajib dipilih"),d(!1);return}const i={tanggal:M,gurket_id:Number(S)},h=(await b.updateJadwalPiket(x.jad_piket_id,i))?.data?.responseData?.jadwal;k(r=>r.map(u=>u.jad_piket_id===x.jad_piket_id?h:u)),c.fire({icon:"success",title:"Berhasil",text:"Jadwal piket berhasil diperbarui"}),_()}else{const t=N(G);if(isNaN(t.getTime())){m("Tanggal mulai tidak valid"),d(!1);return}if([n.senin,n.selasa,n.rabu,n.kamis,n.jumat].some(r=>!r)){m("Semua hari Senin s.d. Jumat wajib memiliki guru piket"),d(!1);return}let i=0,p=0;const h=[];for(let r=0;r<30;r++){const u=new Date(t);u.setDate(t.getDate()+r);const W=u.getFullYear(),q=String(u.getMonth()+1).padStart(2,"0"),Q=String(u.getDate()).padStart(2,"0"),H=`${W}-${q}-${Q}`,D=u.getDay();if(D===0||D===6)continue;const I={1:n.senin,2:n.selasa,3:n.rabu,4:n.kamis,5:n.jumat}[D];if(!I){p++;continue}if(f.some(P=>P.tanggal===H)){p++;continue}try{const K=(await b.createJadwalPiket({tanggal:H,gurket_id:Number(I)}))?.data?.responseData?.jadwal;K?(h.push(K),i++):p++}catch{p++}}h.length>0&&k(r=>[...h,...r]),c.fire({icon:"success",title:"Berhasil",text:`Jadwal dibuat: ${i}. Dilewati: ${p}.`}),_()}}catch(t){const s=t?.response?.data?.responseMessage||"Gagal menyimpan jadwal piket";m(s),c.fire({icon:"error",title:"Gagal",text:s})}finally{d(!1)}}async function F(){if((await c.fire({title:"Hapus Semua Jadwal Piket",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA JADWAL PIKET</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">⚠️ PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua jadwal piket akan dihapus permanen</li>
            <li>Semua data piket harian akan hilang</li>
            <li>Sistem akan kehilangan jadwal piket</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await c.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:s=>{if(s!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const s=await b.deleteAllJadwalPiket();s.status===200&&s.data.responseStatus?(k([]),c.fire({icon:"success",title:"Berhasil",text:"Semua jadwal piket berhasil dihapus"})):c.fire({icon:"error",title:"Gagal",text:s.data.responseMessage||"Gagal menghapus semua jadwal piket"})}catch(s){const i=s?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua jadwal piket";c.fire({icon:"error",title:"Gagal",text:i})}}if(C&&!B)return a.jsx(X,{text:"Memuat data jadwal piket..."});const Y=[{key:"no",label:"No",render:(e,t)=>t+1},{key:"hari",label:"Hari",sortable:!0,accessor:e=>A(e.tanggal),sortValue:e=>A(e.tanggal)},{key:"tanggal",label:"Tanggal",sortable:!0,accessor:e=>E(e.tanggal),sortValue:e=>new Date(e.tanggal)},{key:"guru_piket",label:"Guru Piket",sortable:!0,accessor:e=>e.guru_piket?.nama||"-",sortValue:e=>e.guru_piket?.nama||""},{key:"actions",label:"Action",render:e=>a.jsx("div",{className:"space-x-2",children:a.jsx("button",{onClick:()=>O(e),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"})})}],z=[e=>e.guru_piket?.nama||"",e=>A(e.tanggal),e=>E(e.tanggal)];return a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Jadwal Piket"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:F,disabled:f.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[a.jsx(Z,{size:16}),"Hapus Semua"]}),a.jsx("button",{onClick:R,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Jadwal"})]})]}),T&&a.jsx("div",{className:"mb-3 text-red-600 font-semibold",children:T}),a.jsx(ee,{data:f,columns:Y,searchFields:z,searchPlaceholder:"Cari nama guru, hari, atau tanggal...",emptyMessage:"Belum ada jadwal piket",defaultSort:{field:"tanggal",direction:"desc"}}),B&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[a.jsx("h2",{className:"text-lg font-bold mb-4",children:x?"Edit Jadwal Piket":"Tambah Jadwal Piket"}),a.jsxs("form",{onSubmit:V,children:[x?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Guru Piket"}),a.jsx("select",{value:S,onChange:e=>v(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))})]})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Mulai"}),a.jsx("input",{type:"date",value:G,min:new Date().toISOString().slice(0,10),onChange:e=>J(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senin"}),a.jsxs("select",{value:n.senin,onChange:e=>g(t=>({...t,senin:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selasa"}),a.jsxs("select",{value:n.selasa,onChange:e=>g(t=>({...t,selasa:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rabu"}),a.jsxs("select",{value:n.rabu,onChange:e=>g(t=>({...t,rabu:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kamis"}),a.jsxs("select",{value:n.kamis,onChange:e=>g(t=>({...t,kamis:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jumat"}),a.jsxs("select",{value:n.jumat,onChange:e=>g(t=>({...t,jumat:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Sistem akan membuat jadwal otomatis untuk 30 hari ke depan (hanya hari kerja)."})]}),a.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[a.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),a.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:C?"Menyimpan...":"Simpan"})]})]})]})})]})};export{re as default};
