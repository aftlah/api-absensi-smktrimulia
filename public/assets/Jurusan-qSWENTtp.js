import{j as e}from"./query-vendor-CL32O2jR.js";import{r as i}from"./router-vendor-CjMceo_z.js";import{L as J,t as M,w as E,o as d}from"./admin-pages-BrFGn-Vk.js";import{S as s}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-Ci91RTtW.js";const K=()=>{const[x,l]=i.useState([]),[b,u]=i.useState(!1),[g,m]=i.useState(null),[j,p]=i.useState(!1),[o,h]=i.useState(null),[c,f]=i.useState("");async function S(){u(!0),m(null);try{const n=(await d.getJurusan())?.data?.responseData?.jurusan??[];l(Array.isArray(n)?n:[])}catch{m("Gagal memuat data jurusan")}finally{u(!1)}}i.useEffect(()=>{S()},[]);function k(){h(null),f(""),p(!0)}function w(a){h(a),f(a?.nama_jurusan||""),p(!0)}function y(){p(!1),h(null),f("")}async function N(a){if(a.preventDefault(),!/^[a-zA-Z\s]+$/.test(c)){s.fire({icon:"error",title:"Gagal",text:"Nama jurusan hanya boleh berisi huruf dan spasi"});return}if(!(!c.trim()&&!o))try{if(u(!0),o){const t=(await d.updateJurusan(o.jurusan_id,{nama_jurusan:c.trim()}))?.data?.responseData?.jurusan;l(r=>r.map(A=>A.jurusan_id===o.jurusan_id?t:A)),s.fire({icon:"success",title:"Berhasil",text:"Jurusan berhasil diperbarui"})}else{const t=(await d.createJurusan({nama_jurusan:c.trim()}))?.data?.responseData?.jurusan;l(r=>[t,...r]),s.fire({icon:"success",title:"Berhasil",text:"Jurusan berhasil ditambahkan"})}y()}catch(n){const t=n?.response?.data?.responseMessage||"Gagal menyimpan jurusan";m(t),s.fire({icon:"error",title:"Gagal",text:t})}finally{u(!1)}}async function B(a){if((await s.fire({title:"Hapus jurusan",text:`Hapus jurusan "${a.nama_jurusan}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{u(!0),await d.deleteJurusan(a.jurusan_id),l(t=>t.filter(r=>r.jurusan_id!==a.jurusan_id)),s.fire({icon:"success",title:"Berhasil",text:"Jurusan berhasil dihapus"})}catch(t){const r=t?.response?.data?.responseMessage||"Gagal menghapus jurusan";m(r),s.fire({icon:"error",title:"Gagal",text:r})}finally{u(!1)}}async function C(){if((await s.fire({title:"Hapus Semua Jurusan",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA DATA JURUSAN</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">⚠️ PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua data jurusan akan dihapus permanen</li>
            <li>Semua kelas yang terkait akan dihapus</li>
            <li>Semua riwayat kelas akan dihapus</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await s.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:t=>{if(t!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{u(!0);const t=await d.deleteAllJurusan();t.status===200&&t.data.responseStatus?(l([]),s.fire({icon:"success",title:"Berhasil",text:"Semua data jurusan berhasil dihapus"})):s.fire({icon:"error",title:"Gagal",text:t.data.responseMessage||"Gagal menghapus semua jurusan"})}catch(t){const r=t?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua jurusan";s.fire({icon:"error",title:"Gagal",text:r})}finally{u(!1)}}if(b&&!j)return e.jsx(J,{text:"Memuat data jurusan..."});const v=[{key:"no",label:"No",render:(a,n)=>n+1},{key:"nama_jurusan",label:"Nama Jurusan",sortable:!0,accessor:a=>a.nama_jurusan},{key:"actions",label:"Action",render:a=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>w(a),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>B(a),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Hapus"})]})}],T=["nama_jurusan"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Jurusan"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,disabled:x.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(M,{size:16}),"Hapus Semua"]}),e.jsx("button",{onClick:k,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah jurusan"})]})]}),g&&e.jsx("div",{className:"mb-3 text-red-600 font-semibold",children:g}),e.jsx(E,{data:x,columns:v,searchFields:T,searchPlaceholder:"Cari nama jurusan...",emptyMessage:"Belum ada jurusan",defaultSort:{field:"nama_jurusan",direction:"asc"}}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:o?"Edit Jurusan":"Tambah Jurusan"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Jurusan"}),e.jsx("input",{type:"text",value:c,onChange:a=>f(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:border-blue-300",placeholder:"Contoh: Teknik Komputer dan Jaringan"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:b?"Menyimpan...":"Simpan"})]})]})]})})]})};export{K as default};
