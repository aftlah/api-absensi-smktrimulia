import{j as a}from"./query-vendor-CL32O2jR.js";import{r as o}from"./router-vendor-CjMceo_z.js";import{b as F,C as I,G as P,w as E,g as $}from"./admin-pages-D9Ei6UCr.js";import{E as T,u as y,w as M}from"./utils-vendor-BmMXCZbk.js";import{a as R}from"./gurket-pages-6zlVG5iX.js";import"./react-vendor-BZoW56qi.js";import"./ui-vendor-DAzBgmXi.js";const p=n=>{const r=i=>String(i).padStart(2,"0");return`${n.getFullYear()}-${r(n.getMonth()+1)}-${r(n.getDate())}`},d=n=>{const r=i=>String(i).padStart(2,"0");return`${r(n.getDate())}-${r(n.getMonth()+1)}-${n.getFullYear()}`};function U(){const{user:n}=F(),[r,i]=o.useState(()=>new Date),[c,g]=o.useState(()=>new Date),[u,h]=o.useState("1hari"),[f,k]=o.useState(null),[m,j]=o.useState([]),[S,w]=o.useState(!1),[N,v]=o.useState(""),l=o.useMemo(()=>{const e={hadir:0,terlambat:0,izin:0,sakit:0,alfa:0};return m.forEach(s=>{const t=(s.status||"").toLowerCase();e[t]!==void 0&&(e[t]+=1)}),e},[m]),D=async()=>{if(n?.role==="walas")try{const e=await $.walasInfo(),s=e?.data?.responseData||e?.data?.data||null;k(s)}catch{k(null)}},b=e=>{h(e);const s=new Date,t=new Date;switch(e){case"1hari":i(s),g(s);break;case"1minggu":t.setDate(s.getDate()+6),i(s),g(t);break;case"1bulan":t.setMonth(s.getMonth()+1),i(s),g(t);break;case"1tahun":t.setFullYear(s.getFullYear()+1),i(s),g(t);break;default:i(s),g(s)}},A=async()=>{w(!0),v("");try{const e=await $.lihatAbsensiSiswa({tanggal:p(r),tanggal_akhir:p(c)}),t=(e?.data?.responseData||e?.data||{})?.absensi||[];j(Array.isArray(t)?t:[])}catch{v("Gagal memuat rekap kelas wali."),j([])}finally{w(!1)}};o.useEffect(()=>{D()},[n?.role]),o.useEffect(()=>{A()},[r,c]);const _=[{key:"nis",label:"NIS",sortable:!0,accessor:e=>e.nis||"-"},{key:"nama",label:"Nama",sortable:!0,accessor:e=>e.nama||"-"},{key:"status",label:"Status",sortable:!0,render:e=>a.jsx("span",{className:"capitalize",children:e.status||"-"})},{key:"jam_datang",label:"Jam Datang",sortable:!0,accessor:e=>e.jam_datang||"-"},{key:"jam_pulang",label:"Jam Pulang",sortable:!0,accessor:e=>e.jam_pulang||"-"}],z=()=>{const e=new T;e.setFontSize(16),e.text("Rekap Absensi Kelas Wali",14,15),e.setFontSize(10),e.text(`Kelas: ${f?.kelas_label||"-"}`,14,22),e.text(`Periode: ${d(r)} s.d. ${d(c)}`,14,28),e.text(`Hadir: ${l.hadir} | Terlambat: ${l.terlambat} | Izin: ${l.izin} | Sakit: ${l.sakit} | Alfa: ${l.alfa}`,14,34);const s=m.map(t=>[t.nis||"-",t.nama||"-",(t.status||"-").charAt(0).toUpperCase()+(t.status||"-").slice(1),t.jam_datang||"-",t.jam_pulang||"-"]);R(e,{startY:40,head:[["NIS","Nama","Status","Jam Datang","Jam Pulang"]],body:s,theme:"grid",headStyles:{fillColor:[0,51,102]},styles:{fontSize:9}}),e.save(`Rekap-Absensi-${d(r)}-${d(c)}.pdf`)},C=()=>{const e=[["Rekap Absensi Kelas Wali"],[`Kelas: ${f?.kelas_label||"-"}`],[`Periode: ${d(r)} s.d. ${d(c)}`],[`Hadir: ${l.hadir} | Terlambat: ${l.terlambat} | Izin: ${l.izin} | Sakit: ${l.sakit} | Alfa: ${l.alfa}`],[],["NIS","Nama","Status","Jam Datang","Jam Pulang"],...m.map(x=>[x.nis||"-",x.nama||"-",(x.status||"-").charAt(0).toUpperCase()+(x.status||"-").slice(1),x.jam_datang||"-",x.jam_pulang||"-"])],s=y.aoa_to_sheet(e),t=y.book_new();y.book_append_sheet(t,s,"Rekap Absensi"),M(t,`Rekap-Absensi-${d(r)}-${d(c)}.xlsx`)};return a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsxs("div",{className:"mb-6 p-4 sm:p-6 bg-white rounded-xl shadow-sm border border-gray-200",children:[a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Rekap Absensi Kelas Wali"}),a.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:f?.kelas_label||"Memuat info kelas..."})]})}),a.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:a.jsxs("div",{className:"flex gap-2 mb-4 min-w-max",children:[a.jsx("button",{onClick:()=>b("1hari"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${u==="1hari"?"bg-[#003366] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"1 Hari"}),a.jsx("button",{onClick:()=>b("1minggu"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${u==="1minggu"?"bg-[#003366] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"1 Minggu"}),a.jsx("button",{onClick:()=>b("1bulan"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${u==="1bulan"?"bg-[#003366] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"1 Bulan"}),a.jsx("button",{onClick:()=>b("1tahun"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${u==="1tahun"?"bg-[#003366] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"1 Tahun"})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Dari:"}),a.jsx("input",{type:"date",value:p(r),onChange:e=>{i(new Date(e.target.value)),h("")},className:"flex-1 sm:flex-none px-3 py-1.5 border border-gray-300 rounded-md text-sm"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"Sampai:"}),a.jsx("input",{type:"date",value:p(c),onChange:e=>{g(new Date(e.target.value)),h("")},className:"flex-1 sm:flex-none px-3 py-1.5 border border-gray-300 rounded-md text-sm"})]})]}),a.jsxs("div",{className:"mt-3 text-xs sm:text-sm text-gray-600",children:["Rekap absensi dari tanggal ",a.jsx("span",{className:"font-semibold",children:d(r)})," s.d. ",a.jsx("span",{className:"font-semibold",children:d(c)})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[{key:"hadir",label:"Hadir",color:"bg-green-100 text-green-700",value:l.hadir},{key:"terlambat",label:"Terlambat",color:"bg-yellow-100 text-yellow-700",value:l.terlambat},{key:"izin",label:"Izin",color:"bg-blue-100 text-blue-700",value:l.izin},{key:"sakit",label:"Sakit",color:"bg-red-100 text-red-700",value:l.sakit},{key:"alfa",label:"Alfa",color:"bg-gray-100 text-gray-700",value:l.alfa}].map(e=>a.jsxs("div",{className:`p-4 rounded-xl border border-gray-200 shadow-sm ${e.color}`,children:[a.jsx("p",{className:"text-sm font-medium",children:e.label}),a.jsx("p",{className:"text-2xl font-bold",children:e.value})]},e.key))}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[a.jsxs("button",{onClick:z,disabled:m.length===0,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[a.jsx(I,{size:18}),"Export PDF"]}),a.jsxs("button",{onClick:C,disabled:m.length===0,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[a.jsx(P,{size:18}),"Export Excel"]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-4",children:S?a.jsx("p",{className:"p-4 text-sm text-gray-500",children:"Memuat data rekap..."}):N?a.jsx("p",{className:"p-4 text-sm text-red-600",children:N}):a.jsx(E,{data:m,columns:_,searchFields:["nis","nama","status"],defaultSort:{field:"nama",direction:"asc"},defaultItemsPerPage:10,searchPlaceholder:"Cari NIS, nama, atau status...",emptyMessage:"Tidak ada data absensi untuk periode ini."})})]})})}export{U as default};
