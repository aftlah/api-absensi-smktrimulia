import{j as a}from"./query-vendor-CL32O2jR.js";import{r as t}from"./router-vendor-CjMceo_z.js";import{L as W,w as J,x as R,r as d}from"./admin-pages-BGiHTXEV.js";import{S as l}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-BmMXCZbk.js";const O=()=>{const[N,x]=t.useState([]),[o,E]=t.useState([]),[u,M]=t.useState([]),[_,c]=t.useState(!1),[C,m]=t.useState(null),[B,j]=t.useState(!1),[h,k]=t.useState(null),[K,w]=t.useState("X"),[g,y]=t.useState(""),[S,f]=t.useState(""),[v,b]=t.useState("");async function D(){c(!0),m(null);try{const[e,i,s]=await Promise.all([d.getKelas(),d.getJurusan(),d.getWaliKelas()]),r=e?.data?.responseData?.kelas??[];x(Array.isArray(r)?r:[]),E(i?.data?.responseData?.jurusan??[]),M(s?.data?.responseData?.walas??[])}catch{m("Gagal memuat data kelas")}finally{c(!1)}}t.useEffect(()=>{D()},[]),t.useEffect(()=>{!S&&o.length>0&&f(String(o[0].jurusan_id))},[o]),t.useEffect(()=>{!v&&u.length>0&&b(String(u[0].walas_id))},[u]);function P(){k(null),w("X"),y(""),f(o[0]?.jurusan_id?String(o[0].jurusan_id):""),b(u[0]?.walas_id?String(u[0].walas_id):""),j(!0)}function $(e){k(e),w(e?.tingkat||"X"),y(e?.paralel||""),f(String(e?.jurusan_id||e?.jurusan?.jurusan_id||"")),b(String(e?.walas_id||e?.walas?.walas_id||"")),j(!0)}function T(){j(!1),k(null)}async function G(e){if(e.preventDefault(),!/^[a-zA-Z0-9\s]+$/.test(g)&&g.length>0){l.fire({icon:"error",title:"Gagal",text:"Paralel hanya boleh huruf atau angka"});return}const i=parseInt(S,10),s=parseInt(v,10);if(!Number.isInteger(i)||!o.some(n=>n.jurusan_id===i)){const n="Jurusan wajib dipilih";m(n),l.fire({icon:"error",title:"Gagal",text:n});return}if(!Number.isInteger(s)||!u.some(n=>n.walas_id===s)){const n="Wali kelas wajib dipilih";m(n),l.fire({icon:"error",title:"Gagal",text:n});return}const r={tingkat:K,paralel:g?g.trim().toUpperCase():null,jurusan_id:i,walas_id:s};try{if(c(!0),h){const p=(await d.updateKelas(h.kelas_id,r))?.data?.responseData?.kelas;x(A=>A.map(I=>I.kelas_id===h.kelas_id?p:I)),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil diperbarui"})}else{const p=(await d.createKelas(r))?.data?.responseData?.kelas;x(A=>[p,...A]),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil ditambahkan"})}T()}catch(n){const p=n?.response?.data?.responseMessage||"Gagal menyimpan kelas";m(p),l.fire({icon:"error",title:"Gagal",text:p})}finally{c(!1)}}async function H(e){if((await l.fire({title:"Hapus kelas",text:`Hapus kelas ${e.tingkat} ${e.jurusan?.nama_jurusan??""} ${e.paralel||""}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{c(!0),await d.deleteKelas(e.kelas_id),x(s=>s.filter(r=>r.kelas_id!==e.kelas_id)),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil dihapus"})}catch(s){const r=s?.response?.data?.responseMessage||"Gagal menghapus kelas";m(r),l.fire({icon:"error",title:"Gagal",text:r})}finally{c(!1)}}async function U(){if((await l.fire({title:"Hapus Semua Kelas",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA DATA KELAS</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">⚠️ PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua data kelas akan dihapus permanen</li>
            <li>Semua siswa akan kehilangan kelas</li>
            <li>Semua riwayat kelas akan dihapus</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await l.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:s=>{if(s!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const s=await d.deleteAllKelas();s.status===200&&s.data.responseStatus?(x([]),l.fire({icon:"success",title:"Berhasil",text:"Semua data kelas berhasil dihapus"})):l.fire({icon:"error",title:"Gagal",text:s.data.responseMessage||"Gagal menghapus semua kelas"})}catch(s){const r=s?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua kelas";l.fire({icon:"error",title:"Gagal",text:r})}}if(_&&!B)return a.jsx(W,{text:"Memuat data kelas..."});const X=[{key:"no",label:"No",render:(e,i)=>i+1},{key:"kelas",label:"Kelas",sortable:!0,accessor:e=>`${e.tingkat} ${e.jurusan?.nama_jurusan} ${e.paralel||""}`,sortValue:e=>`${e.tingkat} ${e.jurusan?.nama_jurusan} ${e.paralel||""}`},{key:"walas",label:"Wali Kelas",sortable:!0,accessor:e=>e.walas?.nama||"-",sortValue:e=>e.walas?.nama||""},{key:"actions",label:"Action",render:e=>a.jsxs("div",{className:"space-x-2",children:[a.jsx("button",{onClick:()=>$(e),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),a.jsx("button",{onClick:()=>H(e),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Hapus"})]})}],L=[e=>`${e.tingkat} ${e.jurusan?.nama_jurusan} ${e.paralel||""}`,e=>e.walas?.nama||"","tingkat",e=>e.jurusan?.nama_jurusan||""];return a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Kelas"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:U,disabled:N.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[a.jsx(J,{size:16}),"Hapus Semua"]}),a.jsx("button",{onClick:P,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Kelas"})]})]}),C&&a.jsx("div",{className:"mb-3 text-red-600 font-semibold",children:C}),a.jsx(R,{data:N,columns:X,searchFields:L,searchPlaceholder:"Cari kelas atau wali kelas...",emptyMessage:"Belum ada kelas",defaultSort:{field:"kelas",direction:"asc"}}),B&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[a.jsx("h2",{className:"text-lg font-bold mb-4",children:h?"Edit Kelas":"Tambah Kelas"}),a.jsxs("form",{onSubmit:G,children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tingkat"}),a.jsxs("select",{value:K,onChange:e=>w(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"X",children:"X"}),a.jsx("option",{value:"XI",children:"XI"}),a.jsx("option",{value:"XII",children:"XII"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paralel"}),a.jsx("input",{type:"text",maxLength:1,value:g,onChange:e=>y(e.target.value.toUpperCase()),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"1"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jurusan"}),a.jsx("select",{value:S,onChange:e=>f(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:o.map(e=>a.jsx("option",{value:e.jurusan_id,children:e.nama_jurusan},e.jurusan_id))})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Wali Kelas"}),a.jsx("select",{value:v,onChange:e=>b(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:u.map(e=>a.jsxs("option",{value:e.walas_id,children:[e.nama," (",e.username,")"]},e.walas_id))})]})]}),a.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[a.jsx("button",{type:"button",onClick:T,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),a.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:_?"Menyimpan...":"Simpan"})]})]})]})})]})};export{O as default};
