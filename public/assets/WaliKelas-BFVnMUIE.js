import{j as e}from"./query-vendor-CL32O2jR.js";import{r}from"./router-vendor-CjMceo_z.js";import{L as U,t as D,w as H,o as d}from"./admin-pages-BrFGn-Vk.js";import{S as l}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-Ci91RTtW.js";const F=()=>{const[k,o]=r.useState([]),[P,S]=r.useState([]),[y,i]=r.useState(!1),[G,c]=r.useState(null),[A,p]=r.useState(!1),[u,x]=r.useState(null),[g,f]=r.useState(""),[h,b]=r.useState(""),[L,v]=r.useState("");async function N(){i(!0),c(null);try{const n=(await d.getWaliKelas())?.data?.responseData?.walas??[];o(Array.isArray(n)?n:[]),S([])}catch{c("Gagal memuat data wali kelas")}finally{i(!1)}}r.useEffect(()=>{N()},[]);function B(){x(null),f(""),b(""),v(""),p(!0)}function C(a){x(a),f(a?.username||""),b(a?.nama||""),v(""),p(!0)}function j(){p(!1),x(null)}async function K(a){if(a.preventDefault(),!g.trim()){l.fire({icon:"error",title:"Gagal",text:"Username tidak boleh kosong"});return}if(!/^[a-zA-Z\s]+$/.test(h)){l.fire({icon:"error",title:"Gagal",text:"Nama tidak boleh mengandung angka dan simbol"});return}const n={username:g.trim(),nama:h.trim()};try{if(i(!0),u){const t=(await d.updateWaliKelas(u.walas_id,n))?.data?.responseData?.walas;o(w=>w.map(m=>m.walas_id===u.walas_id?t:m)),l.fire({icon:"success",title:"Berhasil",text:"Wali kelas berhasil diperbarui"})}else{const s=await d.createWaliKelas(n),t=s?.data?.responseData?.walas,w=s?.data?.responseData?.password||"TRI12345";o(m=>[t,...m]),l.fire({icon:"success",title:"Wali Kelas Berhasil Ditambahkan",html:`
            <div class="text-left">
              <p class="mb-3 text-green-600 font-semibold">‚úÖ Wali kelas berhasil ditambahkan!</p>
              
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <h4 class="font-semibold text-blue-800 mb-2">üìã Informasi Login:</h4>
                <div class="space-y-2 text-sm">
                  <div class="flex space-x-1">
                    <span class="text-gray-600">Username:</span>
                    <span class="font-mono bg-gray-100 px-2 py-1 rounded">${n.username}</span>
                  </div>
                  <div class="flex space-x-1">
                    <span class="text-gray-600">Password:</span>
                    <span class="font-mono bg-gray-100 px-2 py-1 rounded">${w}</span>
                  </div>
                </div>
              </div>
              
              <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                <h4 class="font-semibold text-orange-800 mb-2">‚ö†Ô∏è Penting:</h4>
                <p class="text-sm text-orange-700">
                  Harap segera minta wali kelas untuk <strong>mengganti password default</strong> 
                  setelah login pertama kali untuk keamanan akun.
                </p>
              </div>
            </div>
          `,confirmButtonText:"OK, Mengerti",confirmButtonColor:"#003366",width:500,allowOutsideClick:!1,allowEscapeKey:!1})}j()}catch(s){const t=s?.response?.data?.responseMessage||"Gagal menyimpan wali kelas";c(t),l.fire({icon:"error",title:"Gagal",text:t})}finally{i(!1)}}async function T(a){if((await l.fire({title:"Hapus wali kelas",text:`Hapus wali kelas ${a.nama} (${a.username})?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{i(!0),await d.deleteWaliKelas(a.walas_id),o(s=>s.filter(t=>t.walas_id!==a.walas_id)),l.fire({icon:"success",title:"Berhasil",text:"Wali kelas berhasil dihapus"})}catch(s){const t=s?.response?.data?.responseMessage||"Gagal menghapus wali kelas";c(t),l.fire({icon:"error",title:"Gagal",text:t})}finally{i(!1)}}async function W(){if((await l.fire({title:"Hapus Semua Wali Kelas",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA DATA WALI KELAS</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">‚ö†Ô∏è PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua data wali kelas akan dihapus permanen</li>
            <li>Semua akun login wali kelas akan dihapus</li>
            <li>Kelas yang terkait akan kehilangan wali kelas</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await l.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:s=>{if(s!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const s=await d.deleteAllWaliKelas();s.status===200&&s.data.responseStatus?(o([]),l.fire({icon:"success",title:"Berhasil",text:"Semua data wali kelas berhasil dihapus"})):l.fire({icon:"error",title:"Gagal",text:s.data.responseMessage||"Gagal menghapus semua wali kelas"})}catch(s){const t=s?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua wali kelas";l.fire({icon:"error",title:"Gagal",text:t})}}if(y&&!A)return e.jsx(U,{text:"Memuat data wali kelas..."});const E=[{key:"no",label:"No",render:(a,n)=>n+1},{key:"username",label:"Username",sortable:!0,accessor:a=>a.username},{key:"nama",label:"Nama",sortable:!0,accessor:a=>a.nama},{key:"actions",label:"Action",render:a=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>C(a),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>T(a),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Hapus"})]})}],M=["username","nama"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Wali Kelas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:W,disabled:k.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(D,{size:16}),"Hapus Semua"]}),e.jsx("button",{onClick:B,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Wali Kelas"})]})]}),e.jsx(H,{data:k,columns:E,searchFields:M,searchPlaceholder:"Cari username atau nama wali kelas...",emptyMessage:"Belum ada wali kelas",defaultSort:{field:"nama",direction:"asc"}}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:u?"Edit Wali Kelas":"Tambah Wali Kelas"}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:g,onChange:a=>f(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama"}),e.jsx("input",{type:"text",value:h,onChange:a=>b(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",required:!0,placeholder:"Nama Wali Kelas"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:y?"Menyimpan...":"Simpan"})]})]})]})})]})};export{F as default};
