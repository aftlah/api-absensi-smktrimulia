import{j as e}from"./query-vendor-CL32O2jR.js";import{r as i}from"./router-vendor-CjMceo_z.js";import{L as D,t as H,w as I,o as u}from"./admin-pages-BRzz_oB2.js";import{S as r}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-BmMXCZbk.js";const O=()=>{const[y,o]=i.useState([]),[K,N]=i.useState([]),[w,l]=i.useState(!1),[v,d]=i.useState(null),[j,p]=i.useState(!1),[c,g]=i.useState(null),[x,f]=i.useState(""),[b,h]=i.useState(""),[L,A]=i.useState("");async function B(){l(!0),d(null);try{const n=(await u.getGuruPiket())?.data?.responseData?.gurket??[];o(Array.isArray(n)?n:[]),N([])}catch{d("Gagal memuat data guru piket")}finally{l(!1)}}i.useEffect(()=>{B()},[]);function G(){g(null),f(""),h(""),A(""),p(!0)}function C(t){g(t),f(t?.username||""),h(t?.nama||""),A(""),p(!0)}function S(){p(!1),g(null)}async function P(t){if(t.preventDefault(),!x.trim()){r.fire({icon:"error",title:"Gagal",text:"Username tidak boleh kosong"});return}if(!/^[a-zA-Z\s]+$/.test(b)){r.fire({icon:"error",title:"Gagal",text:"Nama tidak boleh mengandung angka dan simbol"});return}const n={username:x.trim(),nama:b.trim()};try{if(l(!0),c){const s=(await u.updateGuruPiket(c.gurket_id,n))?.data?.responseData?.gurket;o(k=>k.map(m=>m.gurket_id===c.gurket_id?s:m)),r.fire({icon:"success",title:"Berhasil",text:"Guru piket berhasil diperbarui"})}else{const a=await u.createGuruPiket(n),s=a?.data?.responseData?.gurket,k=a?.data?.responseData?.password||"TRI12345";o(m=>[s,...m]),r.fire({icon:"success",title:"Guru Piket Berhasil Ditambahkan",html:`
            <div class="text-left">
              <p class="mb-3 text-green-600 font-semibold">‚úÖ Guru piket berhasil ditambahkan!</p>
              
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <h4 class="font-semibold text-blue-800 mb-2">üìã Informasi Login:</h4>
                <div class="space-y-2 text-sm">
                  <div class="flex space-x-1">
                    <span class="text-gray-600">Username:</span>
                    <span class="font-mono bg-gray-100 px-2 py-1 rounded">${n.username}</span>
                  </div>
                  <div class="flex space-x-1">
                    <span class="text-gray-600">Password:</span>
                    <span class="font-mono bg-gray-100 px-2 py-1 rounded">${k}</span>
                  </div>
                </div>
              </div>
              
              <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                <h4 class="font-semibold text-orange-800 mb-2">‚ö†Ô∏è Penting:</h4>
                <p class="text-sm text-orange-700">
                  Harap segera minta guru piket untuk <strong>mengganti password default</strong> 
                  setelah login pertama kali untuk keamanan akun.
                </p>
              </div>
            </div>
          `,confirmButtonText:"OK, Mengerti",confirmButtonColor:"#003366",width:500,allowOutsideClick:!1,allowEscapeKey:!1})}S()}catch(a){const s=a?.response?.data?.responseMessage||"Gagal menyimpan guru piket";d(s),r.fire({icon:"error",title:"Gagal",text:s})}finally{l(!1)}}async function T(t){if((await r.fire({title:"Hapus guru piket",text:`Hapus guru piket ${t.nama} (${t.username})?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{l(!0),await u.deleteGuruPiket(t.gurket_id),o(a=>a.filter(s=>s.gurket_id!==t.gurket_id)),r.fire({icon:"success",title:"Berhasil",text:"Guru piket berhasil dihapus"})}catch(a){const s=a?.response?.data?.responseMessage||"Gagal menghapus guru piket";d(s),r.fire({icon:"error",title:"Gagal",text:s})}finally{l(!1)}}async function U(){if((await r.fire({title:"Hapus Semua Guru Piket",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA DATA GURU PIKET</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">‚ö†Ô∏è PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua data guru piket akan dihapus permanen</li>
            <li>Semua akun login guru piket akan dihapus</li>
            <li>Jadwal piket yang terkait akan kehilangan guru piket</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await r.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:a=>{if(a!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const a=await u.deleteAllGuruPiket();a.status===200&&a.data.responseStatus?(o([]),r.fire({icon:"success",title:"Berhasil",text:"Semua data guru piket berhasil dihapus"})):r.fire({icon:"error",title:"Gagal",text:a.data.responseMessage||"Gagal menghapus semua guru piket"})}catch(a){const s=a?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua guru piket";r.fire({icon:"error",title:"Gagal",text:s})}}if(w&&!j)return e.jsx(D,{text:"Memuat data guru piket..."});const E=[{key:"no",label:"No",render:(t,n)=>n+1},{key:"username",label:"Username",sortable:!0,accessor:t=>t.username},{key:"nama",label:"Nama",sortable:!0,accessor:t=>t.nama},{key:"actions",label:"Action",render:t=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>C(t),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>T(t),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Hapus"})]})}],M=["username","nama"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Guru Piket"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,disabled:y.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(H,{size:16}),"Hapus Semua"]}),e.jsx("button",{onClick:G,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Guru Piket"})]})]}),v&&e.jsx("div",{className:"mb-3 text-red-600 font-semibold",children:v}),e.jsx(I,{data:y,columns:E,searchFields:M,searchPlaceholder:"Cari username atau nama guru...",emptyMessage:"Belum ada guru piket",defaultSort:{field:"nama",direction:"asc"}}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:c?"Edit Guru Piket":"Tambah Guru Piket"}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),e.jsx("input",{type:"text",value:x,onChange:t=>f(t.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama"}),e.jsx("input",{type:"text",value:b,onChange:t=>h(t.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Nama",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:S,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:w?"Menyimpan...":"Simpan"})]})]})]})})]})};export{O as default};
