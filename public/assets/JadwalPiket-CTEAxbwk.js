import{j as a}from"./query-vendor-CL32O2jR.js";import{r as l}from"./router-vendor-CjMceo_z.js";import{L as q,t as Q,w as X,o as h}from"./admin-pages-D9Ei6UCr.js";import{S as c}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-BmMXCZbk.js";const ie=()=>{const[_,k]=l.useState([]),[o,I]=l.useState([]),[P,u]=l.useState(!1),[C,m]=l.useState(null),[T,f]=l.useState(!1),[x,j]=l.useState(null),[B,y]=l.useState(""),[w,S]=l.useState(""),[M,G]=l.useState(""),[n,p]=l.useState({senin:"",selasa:"",rabu:"",kamis:"",jumat:""}),K=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];function b(e){const[t,s,i]=(e||"").split("-").map(Number);return new Date(t,(s||1)-1,i||1)}function v(e){const t=b(e);return K[t.getDay()]||"-"}function J(e){const[t,s,i]=(e||"").split("-");return!t||!s||!i?e||"-":`${i}-${s}-${t}`}async function E(){u(!0),m(null);try{const[e,t]=await Promise.all([h.getJadwalPiket(),h.getGuruPiket()]),s=e?.data?.responseData?.jadwal??[],i=new Date;i.setHours(0,0,0,0);const A=Array.isArray(s)?s.filter(g=>{const r=b(g.tanggal);return r.setHours(0,0,0,0),r>=i}):[];k(A),I(t?.data?.responseData?.gurket??[])}catch{m("Gagal memuat data jadwal piket")}finally{u(!1)}}l.useEffect(()=>{const t=new Date().toISOString().slice(0,10);y(t),E()},[]);function U(){j(null);const t=new Date().toISOString().slice(0,10);y(t),G(t),p({senin:"",selasa:"",rabu:"",kamis:"",jumat:""}),S(o[0]?.gurket_id?String(o[0].gurket_id):""),f(!0)}function L(e){j(e),y(e?.tanggal||""),S(String(e?.gurket_id||e?.guru_piket?.gurket_id||"")),f(!0)}function N(){f(!1),j(null)}async function $(e){e.preventDefault();try{if(u(!0),x){const t=new Date;t.setHours(0,0,0,0);const s=b(B);if(s.setHours(0,0,0,0),s<t){m("Tanggal tidak boleh sebelum hari ini"),u(!1);return}if(!w){m("Guru piket wajib dipilih"),u(!1);return}const i={tanggal:B,gurket_id:Number(w)},g=(await h.updateJadwalPiket(x.jad_piket_id,i))?.data?.responseData?.jadwal;k(r=>r.map(d=>d.jad_piket_id===x.jad_piket_id?g:d)),c.fire({icon:"success",title:"Berhasil",text:"Jadwal piket berhasil diperbarui"}),N()}else{const t=b(M);if(isNaN(t.getTime())){m("Tanggal mulai tidak valid"),u(!1);return}if([n.senin,n.selasa,n.rabu,n.kamis,n.jumat].some(r=>!r)){m("Semua hari Senin s.d. Jumat wajib memiliki guru piket"),u(!1);return}const i=[];for(let r=0;r<365;r++){const d=new Date(t);d.setDate(t.getDate()+r);const F=d.getFullYear(),Y=String(d.getMonth()+1).padStart(2,"0"),z=String(d.getDate()).padStart(2,"0"),W=`${F}-${Y}-${z}`,D=d.getDay();if(D===0||D===6)continue;const H={1:n.senin,2:n.selasa,3:n.rabu,4:n.kamis,5:n.jumat}[D];H&&i.push({tanggal:W,gurket_id:Number(H)})}const g=(await h.bulkCreateJadwalPiket({jadwal:i}))?.data?.responseData;g&&(await E(),c.fire({icon:"success",title:"Berhasil",text:`Jadwal dibuat: ${g.created}. Dilewati: ${g.skipped}.`})),N()}}catch(t){const s=t?.response?.data?.responseMessage||"Gagal menyimpan jadwal piket";m(s),c.fire({icon:"error",title:"Gagal",text:s})}finally{u(!1)}}async function R(){if((await c.fire({title:"Hapus Semua Jadwal Piket",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA JADWAL PIKET</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">⚠️ PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua jadwal piket akan dihapus permanen</li>
            <li>Semua data piket harian akan hilang</li>
            <li>Sistem akan kehilangan jadwal piket</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await c.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:s=>{if(s!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const s=await h.deleteAllJadwalPiket();s.status===200&&s.data.responseStatus?(k([]),c.fire({icon:"success",title:"Berhasil",text:"Semua jadwal piket berhasil dihapus"})):c.fire({icon:"error",title:"Gagal",text:s.data.responseMessage||"Gagal menghapus semua jadwal piket"})}catch(s){const i=s?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua jadwal piket";c.fire({icon:"error",title:"Gagal",text:i})}}if(P&&!T)return a.jsx(q,{text:"Memuat data jadwal piket..."});const O=[{key:"no",label:"No",render:(e,t)=>t+1},{key:"hari",label:"Hari",sortable:!0,accessor:e=>v(e.tanggal),sortValue:e=>v(e.tanggal)},{key:"tanggal",label:"Tanggal",sortable:!0,accessor:e=>J(e.tanggal),sortValue:e=>new Date(e.tanggal)},{key:"guru_piket",label:"Guru Piket",sortable:!0,accessor:e=>e.guru_piket?.nama||"-",sortValue:e=>e.guru_piket?.nama||""},{key:"actions",label:"Action",render:e=>a.jsx("div",{className:"space-x-2",children:a.jsx("button",{onClick:()=>L(e),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"})})}],V=[e=>e.guru_piket?.nama||"",e=>v(e.tanggal),e=>J(e.tanggal)];return a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Jadwal Piket"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:R,disabled:_.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[a.jsx(Q,{size:16}),"Hapus Semua"]}),a.jsx("button",{onClick:U,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Jadwal"})]})]}),C&&a.jsx("div",{className:"mb-3 text-red-600 font-semibold",children:C}),a.jsx(X,{data:_,columns:O,searchFields:V,searchPlaceholder:"Cari nama guru, hari, atau tanggal...",emptyMessage:"Belum ada jadwal piket",defaultSort:{field:"tanggal",direction:"desc"}}),T&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[a.jsx("h2",{className:"text-lg font-bold mb-4",children:x?"Edit Jadwal Piket":"Tambah Jadwal Piket"}),a.jsxs("form",{onSubmit:$,children:[x?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Guru Piket"}),a.jsx("select",{value:w,onChange:e=>S(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))})]})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Mulai"}),a.jsx("input",{type:"date",value:M,min:new Date().toISOString().slice(0,10),onChange:e=>G(e.target.value),className:"w-full border border-gray-300 rounded px-3 py-2"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senin"}),a.jsxs("select",{value:n.senin,onChange:e=>p(t=>({...t,senin:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selasa"}),a.jsxs("select",{value:n.selasa,onChange:e=>p(t=>({...t,selasa:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rabu"}),a.jsxs("select",{value:n.rabu,onChange:e=>p(t=>({...t,rabu:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kamis"}),a.jsxs("select",{value:n.kamis,onChange:e=>p(t=>({...t,kamis:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jumat"}),a.jsxs("select",{value:n.jumat,onChange:e=>p(t=>({...t,jumat:e.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Pilih Guru"}),o.map(e=>a.jsxs("option",{value:e.gurket_id,children:[e.nama," — ",e.username]},e.gurket_id))]})]})]}),a.jsx("p",{className:"text-xs text-gray-500",children:"Sistem akan membuat jadwal otomatis untuk 1 tahun ke depan (365 hari, hanya hari kerja Senin-Jumat)."})]}),a.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[a.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),a.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:P?"Menyimpan...":"Simpan"})]})]})]})})]})};export{ie as default};
