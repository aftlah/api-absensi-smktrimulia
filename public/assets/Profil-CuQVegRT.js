import{j as e}from"./query-vendor-CL32O2jR.js";import{b as S,l as k,o as C,f as o}from"./admin-pages-BRzz_oB2.js";import{r}from"./router-vendor-CjMceo_z.js";import{S as l}from"./ui-vendor-DAzBgmXi.js";import"./utils-vendor-BmMXCZbk.js";import"./react-vendor-BZoW56qi.js";function U(){const{user:a}=S(),[n,d]=r.useState(null),[v,c]=r.useState(!1),[m,i]=r.useState(null),[x,p]=r.useState(""),[u,g]=r.useState(""),[h,f]=r.useState(""),[b,y]=r.useState(!1),[j,N]=r.useState(!1);if(r.useEffect(()=>{(async()=>{try{c(!0);const w=(await o.profile())?.data?.responseData??null;d(w),a?.role!=="siswa"&&p(w?.nama||"")}catch{i("Gagal memuat profil")}finally{c(!1)}})()},[]),v&&!n)return e.jsx("div",{className:"px-4 py-8 max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsx(k,{})});const P=a?.role==="admin"?"bg-purple-100 text-purple-700":a?.role==="gurket"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700";return e.jsxs("div",{className:"min-h-screen p-6 md:p-8",children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold text-gray-800",children:"Informasi Profil"}),e.jsx("main",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-tr from-indigo-500 to-cyan-400 flex items-center justify-center text-white font-bold text-xl",children:(n?.nama||a?.nama||a?.username||"-").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:n?.nama||a?.nama||"-"}),e.jsx("span",{className:`inline-block mt-1 px-3 py-1 rounded-full text-xs font-semibold ${P}`,children:a?.role||"-"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informasi Akun"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-gray-500",children:"Username"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:n?.username||a?.username||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-gray-500",children:"Nama"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:n?.nama||a?.nama||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-gray-500",children:"Role"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:a?.role||"-"})]}),a?.kelas?.nama&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-gray-500",children:"Kelas"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:a.kelas.nama})]})]}),a?.role!=="siswa"&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ubah Nama"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{value:x,onChange:s=>p(s.target.value),className:"flex-1 border border-gray-300 rounded px-3 py-2",placeholder:"Nama"}),e.jsx("button",{disabled:b,onClick:async()=>{try{const s=x.trim();if(!s){l.fire({icon:"error",title:"Gagal",text:"Nama tidak boleh kosong"});return}if(!/^[a-zA-Z\s]+$/.test(s)){l.fire({icon:"error",title:"Gagal",text:"Nama profil hanya boleh berisi huruf dan spasi"});return}y(!0),i(null),a?.role==="admin"?await C.updateMyProfile({nama:s}):await o.updateProfile({nama:s});const t=await o.profile();d(t?.data?.responseData),l.fire({icon:"success",title:"Berhasil",text:"Nama berhasil diperbarui"})}catch(s){const t=s?.response?.data?.responseMessage||"Gagal memperbarui nama";i(t),l.fire({icon:"error",title:"Gagal",text:t})}finally{y(!1)}},className:"px-4 py-2 rounded bg-[#003366] text-white disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Menyimpan..."]}):"Simpan"})]})]}),a?.role!=="siswa"&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reset Password"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"password",value:u,onChange:s=>g(s.target.value),className:"border border-gray-300 rounded px-3 py-2",placeholder:"Password lama"}),e.jsx("input",{type:"password",value:h,onChange:s=>f(s.target.value),className:"border border-gray-300 rounded px-3 py-2",placeholder:"Password baru"}),e.jsx("button",{disabled:j,onClick:async()=>{try{N(!0),i(null),await o.resetPassword({old_password:u,new_password:h}),g(""),f(""),l.fire({icon:"success",title:"Berhasil",text:"Password berhasil diubah"})}catch(s){const t=s?.response?.data?.responseMessage||"Gagal mengubah password";i(t),l.fire({icon:"error",title:"Gagal",text:t})}finally{N(!1)}},className:"px-4 py-2 rounded bg-[#003366] text-white disabled:opacity-50 disabled:cursor-not-allowed",children:j?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Memproses..."]}):"Ganti Password"})]})]}),m&&e.jsx("div",{className:"mt-3 text-red-600 font-semibold",children:m})]})})]})}export{U as default};
