import{j as e}from"./query-vendor-CL32O2jR.js";import{h as z,b as S,L as F,k as T,B as I,v as P,r as B,s as x}from"./admin-pages-BRzz_oB2.js";import{u as D,r as p}from"./router-vendor-CjMceo_z.js";import{F as C,z as l}from"./ui-vendor-DAzBgmXi.js";import"./utils-vendor-BmMXCZbk.js";import"./react-vendor-BZoW56qi.js";const R=()=>{const{handleIzin:j,handleSakit:k,loading:y}=z(),{user:N}=S(),v=D(),b=new Date().toISOString().split("T")[0],[t,h]=p.useState("izin"),[a,m]=p.useState({tanggal:b,keterangan:"",bukti:null}),[i,o]=p.useState({});if(!N)return e.jsx(F,{text:"Memuat data user..."});const f=c=>{const{name:r,value:g,files:d}=c.target;r==="bukti"?(m({...a,bukti:d[0]}),o({...i,bukti:null})):(m({...a,[r]:g}),o({...i,[r]:null}))},w=async c=>{c.preventDefault();const r={keterangan:[x.required,x.minLength(10)],tanggal:[x.required]},{isValid:g,errors:d}=P(a,r);if(a.bukti){const s=B(a.bukti,{maxSize:5242880,allowedTypes:["image/jpeg","image/png","image/jpg","application/pdf"]});s&&(d.bukti=s)}if(o(d),!g){l.error("Harap perbaiki kesalahan pada form ❌");return}const n=new FormData;n.append("tanggal",a.tanggal),n.append("keterangan",a.keterangan),a.bukti&&n.append("bukti",a.bukti),n.append("jenis_absen",t);const u=l.loading(t==="izin"?"Mengirim pengajuan izin...":"Mengirim pengajuan sakit...");try{const s=t==="izin"?await j(n):await k(n);s.success?(l.success(t==="izin"?"Pengajuan izin berhasil dikirim ✅":"Pengajuan sakit berhasil dikirim ✅",{id:u}),m({tanggal:b,keterangan:"",bukti:null}),o({})):l.error(s.message||"Gagal mengirim pengajuan ❌",{id:u})}catch(s){l.error("Terjadi kesalahan saat mengirim pengajuan ❌",{id:u}),console.error(s)}};return e.jsx("div",{className:"min-h-screen bg-gray-50 pb-20",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsx("div",{className:"px-4 pt-8 pb-6 bg-gradient-to-br from-[#4A90E2] to-[#357ABD]",children:e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:"Izin / Sakit"}),e.jsx("p",{className:"text-sm opacity-90",children:"SMK Trimulia"})]}),e.jsx("button",{onClick:()=>v("/siswa/home"),className:"text-sm bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded transition-colors",children:"Kembali"})]})}),e.jsx("main",{className:"px-4 py-8",children:e.jsxs("div",{className:"p-8 bg-white shadow-lg rounded-2xl",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-center text-gray-900",children:"Form Pengajuan Izin / Sakit"}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"flex p-1 space-x-2 bg-gray-100 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>h("izin"),className:`px-4 py-2 rounded-md font-medium transition-all duration-200 
                           ${t==="izin"?"bg-indigo-600 text-white shadow":"text-gray-700 hover:bg-gray-200"}`,children:"Izin"}),e.jsx("button",{type:"button",onClick:()=>h("sakit"),className:`px-4 py-2 rounded-md font-medium transition-all duration-200 
                           ${t==="sakit"?"bg-indigo-600 text-white shadow":"text-gray-700 hover:bg-gray-200"}`,children:"Sakit"})]})}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Tanggal"}),e.jsx("input",{type:"date",name:"tanggal",value:a.tanggal,readOnly:!0,className:"p-2 border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:t==="izin"?"Alasan Izin":"Keterangan Sakit"}),e.jsx("textarea",{name:"keterangan",value:a.keterangan,onChange:f,rows:"4",placeholder:t==="izin"?"Tulis alasan izin...":"Tulis keterangan sakit...",className:`p-2 rounded-lg shadow-sm sm:text-sm focus:ring-indigo-500 focus:border-indigo-500 ${i.keterangan?"border-red-500":"border-gray-300"}`}),i.keterangan&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.keterangan})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-2 text-sm font-medium text-gray-700",children:t==="izin"?"Upload Bukti (opsional: surat izin, dll)":"Upload Bukti (opsional: surat dokter/bukti sakit)"}),e.jsx("input",{type:"file",name:"bukti",onChange:f,accept:".jpg,.jpeg,.png,.pdf",className:`block w-full text-sm text-gray-600 
                           file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm 
                           file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100
                           ${i.bukti?"border border-red-500":""}`}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Opsional. Format: JPG, PNG, atau PDF (maks 2MB)."}),i.bukti&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.bukti}),a.bukti&&e.jsx("div",{className:"mt-3",children:a.bukti.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(a.bukti),alt:"Preview",className:"object-cover w-32 h-32 border rounded-lg"}):e.jsxs("p",{className:"text-sm text-gray-700",children:["File terpilih: ",e.jsx("span",{className:"font-medium",children:a.bukti.name})]})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(T,{type:"submit",loading:y,className:"w-full px-4 py-3 font-medium text-white bg-indigo-600 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:t==="izin"?"Kirim Pengajuan Izin":"Kirim Pengajuan Sakit"})})]})]})}),e.jsx("div",{className:"fixed z-50 bottom-16 right-4",children:e.jsx(C,{position:"bottom-right",reverseOrder:!1})}),e.jsx(I,{})]})})};export{R as default};
