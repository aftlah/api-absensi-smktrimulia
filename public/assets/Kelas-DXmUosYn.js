import{j as e}from"./query-vendor-CL32O2jR.js";import{r as t}from"./router-vendor-CjMceo_z.js";import{L,t as W,w as J,o as c}from"./admin-pages-BRzz_oB2.js";import{S as l}from"./ui-vendor-DAzBgmXi.js";import"./react-vendor-BZoW56qi.js";import"./utils-vendor-BmMXCZbk.js";const O=()=>{const[N,g]=t.useState([]),[o,I]=t.useState([]),[u,E]=t.useState([]),[_,d]=t.useState(!1),[R,m]=t.useState(null),[C,j]=t.useState(!1),[h,k]=t.useState(null),[B,w]=t.useState("X"),[x,y]=t.useState(""),[S,f]=t.useState(""),[v,b]=t.useState("");async function M(){d(!0),m(null);try{const[a,i,s]=await Promise.all([c.getKelas(),c.getJurusan(),c.getWaliKelas()]),r=a?.data?.responseData?.kelas??[];g(Array.isArray(r)?r:[]),I(i?.data?.responseData?.jurusan??[]),E(s?.data?.responseData?.walas??[])}catch{m("Gagal memuat data kelas")}finally{d(!1)}}t.useEffect(()=>{M()},[]),t.useEffect(()=>{!S&&o.length>0&&f(String(o[0].jurusan_id))},[o]),t.useEffect(()=>{!v&&u.length>0&&b(String(u[0].walas_id))},[u]);function D(){k(null),w("X"),y(""),f(o[0]?.jurusan_id?String(o[0].jurusan_id):""),b(u[0]?.walas_id?String(u[0].walas_id):""),j(!0)}function P(a){k(a),w(a?.tingkat||"X"),y(a?.paralel||""),f(String(a?.jurusan_id||a?.jurusan?.jurusan_id||"")),b(String(a?.walas_id||a?.walas?.walas_id||"")),j(!0)}function K(){j(!1),k(null)}async function $(a){if(a.preventDefault(),!/^[a-zA-Z0-9\s]+$/.test(x)&&x.length>0){l.fire({icon:"error",title:"Gagal",text:"Paralel hanya boleh huruf atau angka"});return}const i=parseInt(S,10),s=parseInt(v,10);if(!Number.isInteger(i)||!o.some(n=>n.jurusan_id===i)){const n="Jurusan wajib dipilih";m(n),l.fire({icon:"error",title:"Gagal",text:n});return}if(!Number.isInteger(s)||!u.some(n=>n.walas_id===s)){const n="Wali kelas wajib dipilih";m(n),l.fire({icon:"error",title:"Gagal",text:n});return}const r={tingkat:B,paralel:x?x.trim().toUpperCase():null,jurusan_id:i,walas_id:s};try{if(d(!0),h){const p=(await c.updateKelas(h.kelas_id,r))?.data?.responseData?.kelas;g(A=>A.map(T=>T.kelas_id===h.kelas_id?p:T)),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil diperbarui"})}else{const p=(await c.createKelas(r))?.data?.responseData?.kelas;g(A=>[p,...A]),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil ditambahkan"})}K()}catch(n){const p=n?.response?.data?.responseMessage||"Gagal menyimpan kelas";m(p),l.fire({icon:"error",title:"Gagal",text:p})}finally{d(!1)}}async function G(a){if((await l.fire({title:"Hapus kelas",text:`Hapus kelas ${a.tingkat} ${a.jurusan?.nama_jurusan??""} ${a.paralel||""}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{d(!0),await c.deleteKelas(a.kelas_id),g(s=>s.filter(r=>r.kelas_id!==a.kelas_id)),l.fire({icon:"success",title:"Berhasil",text:"Kelas berhasil dihapus"})}catch(s){const r=s?.response?.data?.responseMessage||"Gagal menghapus kelas";m(r),l.fire({icon:"error",title:"Gagal",text:r})}finally{d(!1)}}async function H(){if((await l.fire({title:"Hapus Semua Kelas",html:`
        <div class="text-left">
          <p class="mb-2">Apakah Anda yakin ingin menghapus <strong>SEMUA DATA KELAS</strong>?</p>
          <p class="text-red-600 font-semibold mb-2">⚠️ PERINGATAN:</p>
          <ul class="text-sm text-gray-700 list-disc list-inside">
            <li>Semua data kelas akan dihapus permanen</li>
            <li>Semua siswa akan kehilangan kelas</li>
            <li>Semua riwayat kelas akan dihapus</li>
          </ul>
          <p class="mt-3 text-red-600 font-bold">Tindakan ini TIDAK DAPAT DIBATALKAN!</p>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Ya, Hapus Semua!",cancelButtonText:"Batal",reverseButtons:!0,focusCancel:!0})).isConfirmed&&(await l.fire({title:"Konfirmasi Terakhir",text:'Ketik "HAPUS SEMUA" untuk melanjutkan',input:"text",inputPlaceholder:"Ketik: HAPUS SEMUA",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"Hapus Semua Data",cancelButtonText:"Batal",inputValidator:s=>{if(s!=="HAPUS SEMUA")return'Anda harus mengetik "HAPUS SEMUA" dengan benar!'}})).isConfirmed)try{const s=await c.deleteAllKelas();s.status===200&&s.data.responseStatus?(g([]),l.fire({icon:"success",title:"Berhasil",text:"Semua data kelas berhasil dihapus"})):l.fire({icon:"error",title:"Gagal",text:s.data.responseMessage||"Gagal menghapus semua kelas"})}catch(s){const r=s?.response?.data?.responseMessage||"Terjadi kesalahan saat menghapus semua kelas";l.fire({icon:"error",title:"Gagal",text:r})}}if(_&&!C)return e.jsx(L,{text:"Memuat data kelas..."});const U=[{key:"no",label:"No",render:(a,i)=>i+1},{key:"kelas",label:"Kelas",sortable:!0,accessor:a=>`${a.tingkat} ${a.jurusan?.nama_jurusan} ${a.paralel||""}`,sortValue:a=>`${a.tingkat} ${a.jurusan?.nama_jurusan} ${a.paralel||""}`},{key:"walas",label:"Wali Kelas",sortable:!0,accessor:a=>a.walas?.nama||"-",sortValue:a=>a.walas?.nama||""},{key:"actions",label:"Action",render:a=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>P(a),className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>G(a),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Hapus"})]})}],X=[a=>`${a.tingkat} ${a.jurusan?.nama_jurusan} ${a.paralel||""}`,a=>a.walas?.nama||"","tingkat",a=>a.jurusan?.nama_jurusan||""];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kelola Kelas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:H,disabled:N.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(W,{size:16}),"Hapus Semua"]}),e.jsx("button",{onClick:D,className:"bg-[#003366] text-white px-4 py-2 rounded hover:bg-[#002244]",children:"Tambah Kelas"})]})]}),e.jsx(J,{data:N,columns:U,searchFields:X,searchPlaceholder:"Cari kelas atau wali kelas...",emptyMessage:"Belum ada kelas",defaultSort:{field:"kelas",direction:"asc"}}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:h?"Edit Kelas":"Tambah Kelas"}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tingkat"}),e.jsxs("select",{value:B,onChange:a=>w(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:[e.jsx("option",{value:"X",children:"X"}),e.jsx("option",{value:"XI",children:"XI"}),e.jsx("option",{value:"XII",children:"XII"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paralel"}),e.jsx("input",{type:"text",maxLength:1,value:x,onChange:a=>y(a.target.value.toUpperCase()),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jurusan"}),e.jsx("select",{value:S,onChange:a=>f(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:o.map(a=>e.jsx("option",{value:a.jurusan_id,children:a.nama_jurusan},a.jurusan_id))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Wali Kelas"}),e.jsx("select",{value:v,onChange:a=>b(a.target.value),className:"w-full border border-gray-300 rounded px-3 py-2",children:u.map(a=>e.jsxs("option",{value:a.walas_id,children:[a.nama," (",a.username,")"]},a.walas_id))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:K,className:"px-4 py-2 rounded border border-gray-300",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-[#003366] text-white",children:_?"Menyimpan...":"Simpan"})]})]})]})})]})};export{O as default};
